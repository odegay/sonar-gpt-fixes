# Use an official Python runtime as a parent image
FROM python:3.9-slim-buster

# Set the working directory in the container to /app
WORKDIR /app

# Install any necessary dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    git \
    libssl-dev

# Clone and build tree-sitter grammars
RUN git clone https://github.com/tree-sitter/tree-sitter-python && \
    cd tree-sitter-python && \
    git checkout $(git describe --tags `git rev-list --tags --max-count=1`) && \
    make

RUN git clone https://github.com/tree-sitter/tree-sitter-javascript && \
    cd tree-sitter-javascript && \
    git checkout $(git describe --tags `git rev-list --tags --max-count=1`) && \
    make

# Clone your project's repository
RUN git clone https://github.com/odegay/sonar-gpt-fixes && \
    cd sonar-gpt-fixes/gptscripts/python && \
    pip install --no-cache-dir -r requirements.txt

# Change working directory to your project's directory
WORKDIR /app/sonar-gpt-fixes/gptscripts/python/

# Make port 80 available to the world outside this container
EXPOSE 80

# Run the command to start your application
CMD ["python", "path/to/your/script.py"]